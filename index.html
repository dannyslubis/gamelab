<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Kemi Kurori Lab Simulation - Sound Edition</title>
    <style>
        body { background: #1a1a1a; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; color: white; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
        #game-container { position: relative; width: 300px; height: 300px; background-image: url('lab.png'); background-size: contain; background-repeat: no-repeat; image-rendering: pixelated; border: 4px solid #444; cursor: pointer; }
        #status-bar { position: absolute; top: 10px; left: 10px; background: rgba(0, 0, 0, 0.8); padding: 8px; border: 1px solid #fff; font-size: 11px; z-index: 100; width: 140px; pointer-events: none; }
        #info-box { margin-top: 5px; color: #00ffcc; font-style: italic; border-top: 1px dashed #555; padding-top: 5px; min-height: 25px; }
        #player { position: absolute; width: 45px; height: 45px; transform: translate(-50%, -50%); image-rendering: pixelated; transition: left 1.5s ease-in-out, top 1.5s ease-in-out; z-index: 10; pointer-events: none; }
        .item { position: absolute; cursor: pointer; image-rendering: pixelated; transition: transform 0.2s; }
        #meja-praktikum { position: absolute; left: 90px; top: 180px; width: 135px; height: 35px; cursor: pointer; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="status-bar">
        <div>Name: Kemi Kurori</div>
        <div>Capacity: <span id="capacity">0/2</span></div>
        <div id="info-box">Info: Siap bekerja.</div>
    </div>

    <img id="player" src="kemikurori.png" style="left: 150px; top: 250px;">

    <img id="beaker" src="beaker.png" class="item" data-type="glass" data-name="Beaker" data-info="Gelas kimia pengukur cairan." style="left: 30px; top: 85px; width: 20px;">
    <img id="labu" src="labu.png" class="item" data-type="glass" data-name="Labu" data-info="Wadah alas bulat pemanasan." style="left: 100px; top: 85px; width: 20px;">
    <img id="tbreaksi" src="tbreaksi.png" class="item" data-type="glass" data-name="Tabung Reaksi" data-info="Tempat reaksi skala kecil." style="left: 165px; top: 85px; width: 15px;">
    <img id="p3k" src="p3k.png" class="item" data-type="box" data-name="P3K" data-info="Kotak P3K darurat." style="left: 250px; top: 185px; width: 25px;">
    <img id="apar" src="apar.png" class="item" data-type="heavy" data-name="APAR" data-info="Alat pemadam api ringan." style="left: 255px; top: 220px; width: 20px;">

    <div id="meja-praktikum"></div>
</div>

<script>
    const player = document.getElementById('player');
    const container = document.getElementById('game-container');
    const infoBox = document.getElementById('info-box');
    const capacityText = document.getElementById('capacity');
    
    let inventory = [];
    const maxInv = 2;
    let stepInterval;

    // --- ENGINE SUARA (Web Audio API) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        if (type === 'step') { // Suara sepatu (thump rendah)
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        } else if (type === 'glass') { // Suara gelas (denting tinggi)
            osc.type = 'sine';
            osc.frequency.setValueAtTime(1200, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start(); osc.stop(audioCtx.currentTime + 0.3);
        } else if (type === 'heavy') { // Suara APAR (dentuman logam)
            osc.type = 'square';
            osc.frequency.setValueAtTime(80, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            osc.start(); osc.stop(audioCtx.currentTime + 0.4);
        } else if (type === 'box') { // Suara P3K (gesekan laci)
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(400, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.start(); osc.stop(audioCtx.currentTime + 0.2);
        }
    }

    // --- LOGIKA PERMAINAN ---
    container.addEventListener('click', (e) => {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        infoBox.innerText = "Info: Merencanakan langkah...";
        setTimeout(() => mulaiJalan(x, y, e.target), 1000);
    });

    function mulaiJalan(x, y, target) {
        player.src = "Untitled 02-27-2026 02-20-45.gif";
        const currentX = parseInt(player.style.left) || 150;
        player.style.transform = x < currentX ? "translate(-50%, -50%) scaleX(-1)" : "translate(-50%, -50%) scaleX(1)";
        player.style.left = x + 'px';
        player.style.top = y + 'px';

        // Suara langkah kaki selama transisi
        stepInterval = setInterval(() => playSound('step'), 300);

        setTimeout(() => {
            clearInterval(stepInterval);
            player.src = "kemikurori.png";
            interaksi(target);
        }, 1500);
    }

    function interaksi(target) {
        if (target.classList.contains('item')) {
            const id = target.id;
            const type = target.getAttribute('data-type');
            const name = target.getAttribute('data-name');
            
            if (inventory.includes(id)) {
                inventory = inventory.filter(i => i !== id);
                target.style.opacity = "1";
                playSound(type); // Suara diletakkan kembali
                infoBox.innerText = "Info: Mengembalikan " + name;
            } else {
                if (inventory.length < maxInv) {
                    inventory.push(id);
                    target.style.opacity = "0.3";
                    playSound(type); // Suara diambil
                    infoBox.innerText = "Info: Membawa " + name;
                } else {
                    infoBox.innerText = "Info: Tangan penuh!";
                }
            }
        } else if (target.id === 'meja-praktikum') {
            if (inventory.length > 0) {
                const lastId = inventory[inventory.length - 1];
                if (lastId === 'apar' || lastId === 'p3k') {
                    infoBox.innerText = "Info: Tidak bisa ditaruh di sini!";
                } else {
                    const itemEl = document.getElementById(lastId);
                    playSound(itemEl.getAttribute('data-type'));
                    inventory.pop();
                    itemEl.style.visibility = "hidden";
                    infoBox.innerText = "Info: Item diletakkan di meja.";
                }
            }
        }
        capacityText.innerText = `${inventory.length}/${maxInv}`;
    }
</script>
</body>
</html>
